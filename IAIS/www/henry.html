<!DOCTYPE html>
<html>
  <head>
    <!--meta http-equiv="refresh" content="8" -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="iais.css">
    <script src="mqttws31.js" type="text/javascript"></script>    
    <script src="konva.min.js"></script>    
    <script src="txn.js"></script>
    <title>Henry</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
      
      #stage-parent {
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="stage-parent">
      <div id="container">
        <div class="konvajs-content" role="presentation" style="position: relative; width: 800px; height: 600px;">
        </div>
      </div>
    </div>
    <script type="text/javascript">
      SUBSCRIBED1 = 'IAIS/turnout/0126';
      
      MYNAME = 'Henry';

      //DRAGGING = true;
      
      // diag under mainline, draw first
      
      // mainline
      // arr.push( { key:  1, imageIdx: 5, locked: true,  state: true, x:  20, y: 107, width:  85, rotation:    0, ssn: "TxN" } );
      arr.push( { key:  3, imageIdx: 5, locked: true,  state: true, x:  20, y:   3, width: 730, rotation:    0, ssn: "TxN" } );
      // arr.push( { key:  5, imageIdx: 5, locked: true,  state: true, x: 108, y:  94, width: 123, rotation:  -45, ssn: "TxN" } );
           
      arr.push( { key:  7, imageIdx: 2, locked: true,  state: true, x:  20, y:   3, width:  69, rotation:    0, ssn: "TxN" } );
      arr.push( { key:  9, imageIdx: 1, locked:false,  state: true, x:  129, y:  54, width:  40, rotation:  180, ssn: "IAIS\/turnout\/0126\/01" } )
      // arr.push( { key:  9, imageIdx: 0, locked:false,  state: true, x:  95, y:  95, width:  40, rotation:    0, ssn: "IAIS\/turnout\/0126\/99", inv:true } )
      arr.push( { key: 11, imageIdx: 2, locked: true,  state: true, x: 359, y:  56, width:  63, rotation:    0, ssn: "TxN" } );
      arr.push( { key: 12, imageIdx: 2, locked: true,  state: true, x: 475, y: 158, width: 214, rotation:    0, ssn: "TxN" } );
      arr.push( { key: 13, imageIdx: 0, locked: false, state: true, x: 461, y: 107, width:  40, rotation:  180, ssn: "IAIS\/turnout\/0126\/04" } );
      
      arr.push( { key: 15, imageIdx: 1, locked: false, state: true, x: 360, y: 107, width:  40, rotation:  180, ssn: "IAIS\/turnout\/0126\/03" } );
      arr.push( { key: 17, imageIdx: 2, locked: true,  state: true, x: 480, y: 132, width: 209, rotation:    0, ssn: "TxN" } );
      arr.push( { key: 23, imageIdx: 1, locked: false, state: true, x: 481, y: 183, width:  40, rotation:  180, ssn: "IAIS\/turnout\/0126\/10" } );
      arr.push( { key: 25, imageIdx: 1, locked: false, state: true, x: 294, y: 190, width:  40, rotation:  -45, ssn: "IAIS\/turnout\/0126\/07", inv:true } );
      arr.push( { key: 29, imageIdx: 2, locked: true,  state: true, x: 495, y:  29, width: 161, rotation:    0, ssn: "TxN" } );
      
      arr.push( { key: 31, imageIdx: 2, locked: true,  state: true, x: 128, y:   3, width: 523, rotation:    0, ssn: "TxN" } );     
      arr.push( { key: 33, imageIdx: 2, locked: true,  state: true, x: 689, y:   3, width: 60, rotation:    0, ssn: "TxN" } );     

      // siding
      arr.push( { key: 35, imageIdx: 2, locked: true,  state: true, x:  94, y: 192, width: 224, rotation:    0, ssn: "TxN" } );
      
      arr.push( { key: 39, imageIdx: 1, locked: false, state: true, x: 325, y:  80, width:  40, rotation:  180, ssn: "IAIS\/turnout\/0126\/02" } );
      arr.push( { key: 41, imageIdx: 0, locked: false, state: true, x: 421, y: 123, width:  40, rotation:   45, ssn: "IAIS\/turnout\/0126\/09", inv:true } );
      arr.push( { key: 43, imageIdx: 1, locked: false, state: true, x: 334, y: 150, width:  40, rotation:  -45, ssn: "IAIS\/turnout\/0126\/08", inv:true } );

      // arr.push( { key: 45, imageIdx: 6, locked: true,  state: true, x: 596, y:  27, width:  40, rotation:    0, ssn: "IAIS\/turnout\/0126\/99" } );
      arr.push( { key: 47, imageIdx: 0, locked: false, state: true, x: 690, y:  54, width:  40, rotation:  180, ssn: "IAIS\/turnout\/0126\/06" } );
      arr.push( { key: 49, imageIdx: 0, locked: false, state: true, x: 496, y:  80, width:  40, rotation:  180, ssn: "IAIS\/turnout\/0126\/05" } );
      // arr.push( { key: 51, imageIdx: 2, locked: true,  state: true, x: 577, y:  97, width:  44, rotation:  135, ssn: "TxN" } );
      
      // track #1
      arr.push( { key: 53, imageIdx: 2, locked: true,  state: true, x:  94, y: 131, width: 249, rotation:    0, ssn: "TxN" } );
      arr.push( { key: 54, imageIdx: 2, locked: true,  state: true, x:  94, y: 171, width: 213, rotation:    0, ssn: "TxN" } );
      arr.push( { key: 55, imageIdx: 2, locked: true,  state: true, x: 324, y:  29, width: 133, rotation:    0, ssn: "TxN" } );
      arr.push( { key: 57, imageIdx: 2, locked: true,  state: true, x: 123, y:  29, width: 163, rotation:    0, ssn: "TxN" } );
      arr.push( { key: 59, imageIdx: 2, locked: true,  state: true, x: 464, y: 192, width: 224, rotation:    0, ssn: "TxN" } );
      
      // diags
      arr.push( { key: 71, imageIdx: 2, locked: true,  state: true, x: 368, y:  87, width:  64, rotation:   45, ssn: "TxN" } );
      //arr.push( { key: 73, imageIdx: 2, locked: true,  state: true, x: 319, y: 126, width:  10, rotation:  -45, ssn: "TxN" } );
      arr.push( { key: 77, imageIdx: 2, locked: true,  state: true, x: 369, y: 132, width:  64, rotation:  -45, ssn: "TxN" } );
      arr.push( { key: 79, imageIdx: 2, locked: true,  state: true, x: 440, y: 159, width:  56, rotation:   45, ssn: "TxN" } );
      
      arr.push( { key: 81, imageIdx: 2, locked: true,  state: true, x: 328, y: 173, width:  21, rotation:  -45, ssn: "TxN" } );
      // arr.push( { key: 83, imageIdx: 2, locked: true,  state: true, x: 176, y:  91, width:  10, rotation:  -45, ssn: "TxN" } );
      // arr.push( { key: 85, imageIdx: 2, locked: true,  state: true, x: 376, y:  75, width:  10, rotation:  -45, ssn: "TxN" } );
      // arr.push( { key: 87, imageIdx: 2, locked: true,  state: true, x: 337, y:  114, width:  19, rotation:  -45, ssn: "TxN" } );

      // X-overs last to be on top
      //arr.push( { key: 89, imageIdx: 4, locked: false, state: true, x: 598, y:  10, width:  58, height: 58, rotation: 0, ssn: "IAIS\/turnout\/0126\/L1" } );

      texts = [];
      
      arr.push( { key: 90, imageIdx: 12, locked: true,  state: true, x: 160, y: 131, width:  40, rotation:    0, ssn: "TxN" } );
      texts.push( new Konva.Text( { x: 202, y: 136, fontFamily: 'Arial', fontSize: 12, text: 'LO', fill: 'black' } ) );
      
      arr.push( { key: 91, imageIdx: 13, locked: true,  state: true, x: 130, y: 171, width:  40, rotation:    0, ssn: "TxN" } );
      texts.push( new Konva.Text( { x: 172, y: 176, fontFamily: 'Arial', fontSize: 12, text: 'TA', fill: 'black' } ) );
      
      arr.push( { key: 92, imageIdx: 14, locked: true,  state: true, x: 220, y: 171, width:  40, rotation:    0, ssn: "TxN" } );
      texts.push( new Konva.Text( { x: 262, y: 176, fontFamily: 'Arial', fontSize: 12, text: 'TA', fill: 'black' } ) );
      
      arr.push( { key: 93, imageIdx: 13, locked: true,  state: true, x: 130, y: 192, width:  40, rotation:    0, ssn: "TxN" } );
      texts.push( new Konva.Text( { x: 172, y: 197, fontFamily: 'Arial', fontSize: 12, text: 'LO', fill: 'black' } ) );
      
      arr.push( { key: 94, imageIdx: 14, locked: true,  state: true, x: 220, y: 192, width:  40, rotation:    0, ssn: "TxN" } );
      texts.push( new Konva.Text( { x: 262, y: 197, fontFamily: 'Arial', fontSize: 12, text: 'LO', fill: 'black' } ) );
      
      arr.push( { key: 95, imageIdx: 12, locked: true,  state: false, x: 560, y: 131, width:  40, rotation:    0, ssn: "TxN" } );
      texts.push( new Konva.Text( { x: 602, y: 137, fontFamily: 'Arial', fontSize: 12, text: 'LO', fill: 'black' } ) );
      
      arr.push( { key: 96, imageIdx: 13, locked: true,  state: false, x: 500, y: 158, width:  40, rotation:    0, ssn: "TxN" } );
      texts.push( new Konva.Text( { x: 542, y: 163, fontFamily: 'Arial', fontSize: 12, text: 'LO', fill: 'black' } ) );
      
      arr.push( { key: 97, imageIdx: 13, locked: true,  state: false, x: 590, y: 158, width:  40, rotation:    0, ssn: "TxN" } );
      texts.push( new Konva.Text( { x: 632, y: 163, fontFamily: 'Arial', fontSize: 12, text: 'TA', fill: 'black' } ) );
      
      arr.push( { key: 98, imageIdx: 14, locked: true,  state: false, x: 500, y: 192, width:  40, rotation:    0, ssn: "TxN" } );
      texts.push( new Konva.Text( { x: 542, y: 197, fontFamily: 'Arial', fontSize: 12, text: 'LO', fill: 'black' } ) );
      
      arr.push( { key: 99, imageIdx: 14, locked: true,  state: false, x: 590, y: 192, width:  40, rotation:    0, ssn: "TxN" } );
      texts.push( new Konva.Text( { x: 632, y: 197, fontFamily: 'Arial', fontSize: 12, text: 'TA', fill: 'black' } ) );



      texts.push( new Konva.Text( { x:  15, y:   5, fontFamily: 'Arial', fontSize: 12, text: '< Bureau (BU)', fill: 'black' } ) );
      texts.push( new Konva.Text( { x:  20, y:  32, fontFamily: 'Arial', fontSize: 10, text: 'North', fill: 'black' } ) );
      texts.push( new Konva.Text( { x: 685, y:   5, fontFamily: 'Arial', fontSize: 12, text: 'Peoria (PE) >', fill: 'black' } ) );
      texts.push( new Konva.Text( { x: 715, y: 32, fontFamily: 'Arial', fontSize: 10, text: 'South', fill: 'black' } ) );
      // texts.push( new Konva.Text( { x: 640, y:  65, fontFamily: 'Arial', fontSize: 12, text: 'Escape', fill: 'black' } ) );
      
      texts.push( new Konva.Text( { x: 364, y:  33, fontFamily: 'Arial', fontSize: 12, text: 'Siding', fill: 'black' } ) );
      texts.push( new Konva.Text( { x: 540, y:  100, fontFamily: 'Arial', fontSize: 14, text: 'Centilion Fertilizer', fill: 'black' } ) );
      texts.push( new Konva.Text( { x: 100, y:  100, fontFamily: 'Arial', fontSize: 14, text: 'Mexichem Specialty Resins', fill: 'black' } ) );
      texts.push( new Konva.Text( { x: 364, y:  200, fontFamily: 'Arial', fontSize: 16, text: 'HENRY', fill: 'black', fill: '#007F7F' } ) );												      
      // textDebug from txn.js
      texts.push( textDebug );

      for( i = 0; i < texts.length; i++ ) {
        textLayer.add( texts[i] );
      }

      myWidth = 780;
      myHeight = 220;
                      
      var stage = new Konva.Stage( {
        container: 'container',
        width: myWidth,
        height: myHeight
      } );
     
      stage.on( 'click', function( evt ) {
        doIt( evt );
      } );  // on
     
      stage.on( 'tap', function( evt ) {
        doIt( evt );
      } );  // on
     
      loadImages( arr, imageLayer );
     
      stage.add( textLayer );
      stage.add( imageLayer );

      setupClient( MYNAME );
     
      // connect the client
      client.connect( options );

      fitStageIntoParentContainer();
      // adapt the stage on any window resize
      window.addEventListener( 'resize', fitStageIntoParentContainer );
                      
      //
      // Google Drive has the draggable code that was removed here
      //
      function updateText( e ) {
        if ( e ) {
          var lines = [
            'arr.push( { key: ' + e.target.id,
            'imageIdx: ' + e.target.imageIdx,
            'locked: ' + e.target.locked,
            'inv: ' + e.target.inv,		     
            'state: ' + e.target.state,
            'x: ' + e.target.x(),
            'y: ' + e.target.y(),
     
            'width: ' + e.target.width(),
            'height: ' + e.target.height(),
            'rotation: ' + e.target.rotation(),
            'ssn: "' + e.target.ssn + '" } );'
           ];
           var newText = lines.join('; '); 

          document.getElementById('_info').innerHTML = "info ->" + newText;
          textLayer.batchDraw();
        }
      }   
    </script>
    <br>        
    <table>
      <tr>
        <td>#===#</td>
        <td><a href="bureau.html">BU</a></td>
        <td>#===#</td>
        <td><a href="peoria.html">PE</a></td>
      </tr>
    </table>
    <p id="_route"></p>
    <p id="_info"></p>
    <div class="footer">
      <a href="/"><div id="_logLine">...connecting ...</div></a>
      <div id="_logSent"></div>
    </div>
  </body>
</html>
